<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#000">
    
    <title>MetaMax</title>


    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/version.css">

    <script src="js/d3.v4.min.js"></script>
    <script src="js/mongo_query.js"></script>
    <script src="js/stopwords.js"></script>
    <script src="js/word_merge.js"></script>

    <script>
        function map() {
            var words = this.text.replace(/[^A-Za-zÄäÖöÜüß ]/g, " ").split(" ");
            for (var i = 0; i < words.length; i++) {
                var word = words[i];
                if(word) {
                    emit(words[i], 1);
                }
            }
        }

        function render(arr) {
            data = arr.filter(word => stopwords.indexOf(word["_id"].toLowerCase()) < 0).sort((a,b) => b["value"] - a["value"]);

            console.log(data);

            d3.select("main")
                    .selectAll("div")
                    .data(data)
                    .enter()
                    .append("div")
                    .style("font-size", d => d["value"] + "px")
                    .text(d => d["_id"])
                    .classed("word", true)
                    .style("top", () => Math.random() * 100 + "%")
                    .style("left", () => Math.random() * 100 + "%");
        }

        mongo_query(map, count, render);
    </script>
</head>
<body>
<main>
    <!-- this is the d3.js container -->
</main>
</body>
</html>
